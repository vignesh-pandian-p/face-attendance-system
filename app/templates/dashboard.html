{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i data-lucide="layout-dashboard"></i> Dashboard</h1>
  </div>

  <div class="row">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3">
            <div class="card-header">Total Classes</div>
            <div class="card-body">
                <h5 class="card-title">{{ total_classes }}</h5>
            </div>
        </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          Students per Class
        </div>
        <div class="card-body">
          <canvas id="studentsPerClassChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          Today's Attendance per Class
        </div>
        <div class="card-body">
          <canvas id="attendancePerClassChart"></canvas>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  const studentsPerClassCtx = document.getElementById('studentsPerClassChart');
  new Chart(studentsPerClassCtx, {
    type: 'bar',
    data: {
      labels: {{ class_names|tojson }},
      datasets: [{
        label: '# of Students',
        data: {{ student_counts|tojson }},
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  const attendancePerClassCtx = document.getElementById('attendancePerClassChart');
  new Chart(attendancePerClassCtx, {
    type: 'bar',
    data: {
      labels: {{ class_names|tojson }},
      datasets: [
        {
          label: 'Present',
          data: {{ present_counts|tojson }},
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        },
        {
          label: 'Absent',
          data: {{ absent_counts|tojson }},
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      scales: {
        x: {
          stacked: true,
        },
        y: {
          stacked: true,
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}
